<main>

    <%= render partial: 'layouts/header_profile', locals: {page_type: 'establishment'} %> 

    <section class="pt-5 pt-lg-0 bg-secondary">
        <div class="container">
            <div class="row">

                <%= render partial: 'layouts/card_profile', locals: {page_type: 'establishment'} %> 

                <div class="col-md-8 mt-lg-5 mb-5">

                    <!-- General -->

                    <!-- Timeline -->
                    <div class="card">
                        <div class="card-body ">
                            <div class="d-lg-flex mt-3">
                                <a class="media d-flex align-items-center mr-lg-5 mb-3 mb-lg-0">

                                    
                                    <div class="media-body pl-2">
                                        <span class="h6"><%= @sub_cat_hash.count %> services proposés</span>
                                    </div>
                                </a>
                                <a class="media d-flex align-items-center mr-lg-5 mb-3 mb-lg-0">
                                    <img alt="Image placeholder" src="../assets/img/icons/dusk/svg/natural-user-interface-1.svg" style="width: 36px;">
                                    <div class="media-body pl-2">
                                        <span class="h6"><%= @establishment.teachers.length %> professeurs sont inscrits</span>
                                    </div>
                                </a>
                            </div>
                            <div class="pt-5 mt-5 delimiter-top">
                                <!-- Interests -->
                                <h6><i class="fas fa-user mr-2 "></i>Service(s) proposé(s)</h6>
                                <div class="pt-3">
                                	<% @sub_cat_hash.each do |sub_cat, sub_cat_teachers| %>
		                                <li class="btn-sm btn-secondary nav-item dropdown dropdown-animate mt-3" data-toggle="hover" id="button-profile">
		                                    <a class="nav-link" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><%= sub_cat %></a>
		                                    <div class="dropdown-menu dropdown-menu-md dropdown-menu-arrow " style="width: 170px">
		                                        <div class="list-group">
		                                        	<% sub_cat_teachers.each do |teacher| %>
    		                                            <a href="<%=teacher_path(teacher)%>" class="list-group-item list-group-item-action ">
    		                                                <div class="media d-flex align-items-center">
    		                                                    <div class="media-body ml-3">
    		                                                        <h6 class="mb-1"><%= teacher.first_name %> <%= teacher.last_name %></h6>
    		                                                    </div>
    		                                                </div>
    		                                            </a>
													<% end %>
		                                        </div>
		                                    </div>
		                                </li>
									<% end %>
                                </div>
                            </div>
                            <div class="pt-5 mt-5 delimiter-top">
                                <!-- Endorsements -->
                                <h6><i class="fas fa-user mr-2"></i>Professeur(s) inscrit(s) à <%= @establishment.name %></h6>
                                <div class="row">

    								<% @establishment.teachers.each do |teacher| %>
    								    <% teach_sub_cat = [] %>
    								    <% teacher.sub_categories.each do |sub_cat| %>
    								      <% teach_sub_cat << sub_cat.title %>
    								    <% end %>
    								    <% string_result = teach_sub_cat.sort.uniq.join(', ') %>
    								    <% string_result = "(" +string_result+")"%>
                                        <div class="col-lg-6 mt-4">
                                            <div class="card bg-secondary shadow-sm border-0">
                                                <div class="media align-items-center p-3" >
                                                    <a href="#" class="avatar rounded-circle mr-2">
                                                        <img alt="Image placeholder" src="../assets/img/prv/team-1-800x800.jpg">
                                                    </a>
                                                    <div class="media-body">
                                                        <h6 class="text-sm mb-0"><a href="<%=teacher_path(teacher)%>"> <%= teacher.first_name %> <strong><%= teacher.last_name %></strong></a></h6>
                                                        <p class="text-sm mb-0"><%= teacher.email %></p>
                                                        <p class="text-sm mb-0"><%= string_result %></p>
                                                        <a href="<%=resource_teacher_events_path(@establishment.resources.first,teacher)%>">Réserver un cours</a>
                                                        <% if current_establishment == @establishment %>
                                                            <a href="<%= teacher_teacher_establishment_path(teacher, current_establishment)%>" class="text-light" data-toggle="tooltip" data-original-title="Remove item" data-method="DELETE" data-confirm="Are you sure?" >
                                                            <i class="fas fa-trash-alt"></i>
                                                            </a>
                                                        <% end %>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <% end %>
                                    <% if @establishment == current_establishment %>
                                        <div class="d-flex  justify-content-space-between text-center mx-3 pt-3">
                                            <span class="badge badge-lg badge-info mr-2 mb-2" id="hidden">Ajouter un professeur</span>
                                            <%= form_tag(establishment_teacher_establishments_path(@establishment)) do %>
                                              <%= select_tag "teacher_id", options_from_collection_for_select(@teachers, "id", "email"), class: "btn-sm btn-outline-primary dropdown-toggle", type: "button" %>
                                              <%= submit_tag("Ajouter", class: "btn btn-sm btn-primary") %>
                                            <% end %>
                                        </div>
                                        <div class="container">
                                        <div>
                                            <%= link_to '<i class="fas fa-sliders-h"></i> &nbsp; Modifier mon profil'.html_safe, edit_establishment_registration_path, class: "badge badge-lg badge-info mr-2 mb-2", id: "btn-group-settings"  %>
                                        </div>
                                </div>
                                </div>
                                <% end %>
                                <br>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Call to action -->

    <section class="slice slice-lg bg-primary">
        <span class="tongue tongue-top tongue-secondary"><i class="fas fa-angle-up"></i></span>
        <div class="container">
            <div class="row justify-content-center align-items-center">
                <div class="col-lg-8 text-center">
                    <h3 class="font-weight-400 text-white">Vous souhaitez vous inscrire à <span class="font-weight-700"><%= @establishment.name %></span>.</h3>
                    <div class="mt-5">
                        <a href="#" class="btn btn-white btn-circle btn-translate--hover px-4">Je m'inscris</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

